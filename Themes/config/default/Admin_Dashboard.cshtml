@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightRazor>
@using System
@using System.Globalization
@using System.Text
@using System.Web
@using System.Web.Razor.Parser
@using System.Web.Razor.Parser.SyntaxTree
@using System.Xml
@using DotNetNuke.Common
@using NBrightDNN
@using Nevoweb.DNN.NBrightBuy.Components;
@using NBrightCore.common;
@using NBrightDNN.render


@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightBuy/App_LocalResources/")

@{
    var info = (NBrightInfo)Model.List.First();
}


<div id="pageactionssource"><!-- Page actions are moved into header bar - also exist at page bottom-->
	<div class="col-xs-9 col-sm-9">
		<a href="javascript:void(0)" class="show-sidebar">
		  <i class="fa fa-bars"></i>
		</a>
		<div class="actionbuttonwrapper">
            <a id="cmdRefresh" class="btn btn-primary " href="?ctrl=dashsummary&refresh=1">@ResourceKey("General.Refresh")</a>
	    </div>
	</div>
	<div class="col-xs-3 col-sm-3 top-panel-right">
		<!-- No language in this page -->
	</div>
</div>

<br/>

<script type="text/javascript">

function xGraphOrderTotals(){
	
	var data = {
		"xScale": "ordinal",
		"yScale": "linear",
		"main": [
			{
			"className": ".ordertotals",
            "data": [@CreateXchartOrderRevDataBind(info)]
			}
		]
	};
	
	var myChart = new xChart('bar', data, '#orderstats');

}

	$( document ).ready(function() {
		xGraphOrderTotals();
	});

</script>

<div class="row dashboard">

    <div class="col-xs-12 col-sm-8">
        <div class="box">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-table"></i>
                    <span>@ResourceKey("General.MontlyRevenue")</span>
                </div>
                <div class="box-icons">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="expand-link">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                <div class="no-move"></div>
            </div>
            <div class="box-content">

                <div style="width: 100%; height: 200px;" id="orderstats">

                </div>

            </div>
        </div>


        <div class="box orderslist">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-table"></i>
                    <span>@ResourceKey("General.Orders")</span>
                </div>
                <div class="box-icons">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="expand-link">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                <div class="no-move"></div>
            </div>
            <div class="box-content">
                <table class="table table-striped table-hover table-responsive">
                    <thead>
                        <tr>
                            <th>@ResourceKey("General.Customer")</th>
                            <th>@ResourceKey("General.Total")</th>
                            <th>@ResourceKey("General.OrderNumber")</th>
                            <th>@ResourceKey("General.OrderDate")</th>
                            <th>@ResourceKey("General.status")</th>
                        </tr>
                    </thead>
                    <tbody>

                        @{ 
                            var orderlist = new List<NBrightInfo>();
                            var nodList = info.XMLDoc.SelectNodes("root/orders/item");
                            foreach (XmlNode n in nodList)
                            {
                                var nbi = new NBrightInfo();
                                nbi.XMLData = n.SelectSingleNode("genxml/genxml").OuterXml;
                                nbi.ItemID = Convert.ToInt32(n.SelectSingleNode("itemid").InnerText);
                                orderlist.Add(nbi);
                            }

                        }

                            @foreach (NBrightInfo nbi in orderlist)
                            {
                                var timeout = "";
                                var rawdate = nbi.GetXmlPropertyRaw("genxml/createddate");
                                if (NBrightCore.common.Utils.IsDate(rawdate))
                                {
                                    timeout = Convert.ToDateTime(rawdate).ToString("T");
                                }

                                <tr>
                                    <td>
                                        <div>
                                            <strong>@nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/firstname") @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/lastname")</strong>
                                        </div>
                                        <div>
                                            @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/email")
                                        </div>
                                        <div>
                                            @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/unit") @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/street")
                                            @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/city") @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/region") @nbi.GetXmlProperty("genxml/shipaddress/genxml/dropdownlist/region/@selectedtext")
                                            @nbi.GetXmlProperty("genxml/billaddress/genxml/textbox/postalcode") @nbi.GetXmlProperty("genxml/billaddress/genxml/dropdownlist/country/@selectedtext")
                                        </div>
                                    </td>

                                    <td>@CurrencyOf(nbi.GetXmlPropertyDouble("genxml/appliedtotal"))</td>
                                    <td>@nbi.GetXmlProperty("genxml/ordernumber")</td>
                                    <td>@nbi.GetXmlProperty("genxml/createddate") @(timeout)</td>
                                    <td>
                                        <span class="orderstatus orderstatus@(nbi.GetXmlProperty("genxml/dropdownlist/orderstatus"))">@ResourceKey("General.orderstatus" + nbi.GetXmlProperty("genxml/dropdownlist/orderstatus"))</span>
                                    </td>
                                </tr>
                            }

                    </tbody>
                </table>
            </div>
        </div>

    </div>


    <div class="col-xs-12 col-sm-4">
        <div class="box ui-draggable ui-droppable">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-table"></i>
                    <span>@ResourceKey("General.Catalogue")</span>
                </div>
                <div class="box-icons">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="expand-link">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                <div class="no-move"></div>
            </div>
            <div class="box-content">

                <table class="table table-striped table-hover">
                    <tr>
                        <td>@ResourceKey("General.TotalProducts")</td>
                        <td class="text-right">@info.GetXmlPropertyInt("root/row/totalproducts")</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.HiddenProducts")</td>
                        <td class="text-right">@info.GetXmlPropertyInt("root/row/hiddenproducts")</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.ActiveProducts")</td>
                        <td class="text-right">@info.GetXmlPropertyInt("root/row/activeproducts")</td>
                    </tr>
                </table>

            </div>
        </div>

        <div class="box ui-draggable ui-droppable">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-table"></i>
                    <span>@ResourceKey("General.Sales")</span>
                </div>
                <div class="box-icons">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="expand-link">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                <div class="no-move"></div>
            </div>
            <div class="box-content">

                <table class="table table-striped table-hover">
                    <tr>
                        <td>@ResourceKey("General.OrderCount")</td>
                        <td class="text-right">@info.GetXmlPropertyInt("root/row/totalorders")</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.CustomerCount")</td>
                        <td class="text-right">@info.GetXmlPropertyInt("root/row/clientcount")</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.TotalRevenue")</td>
                        <td class="text-right">@CurrencyOf(info.GetXmlPropertyDouble("root/row/totalrevenue"))</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.AverageRevenue")</td>
                        <td class="text-right">@CurrencyOf(info.GetXmlPropertyDouble("root/row/avgorder"))</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.TotalDiscounts")</td>
                        <td class="text-right">@CurrencyOf(info.GetXmlPropertyDouble("root/row/applieddiscount"))</td>
                    </tr>
                    <tr>
                        <td>@ResourceKey("General.TotalShipping")</td>
                        <td class="text-right">@CurrencyOf(info.GetXmlPropertyDouble("root/row/appliedshipping"))</td>
                    </tr>
                </table>

            </div>
        </div>

        <div class="box ui-draggable ui-droppable">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-table"></i>
                    <span>@ResourceKey("General.StatusofOrders")</span>
                </div>
                <div class="box-icons">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="expand-link">
                        <i class="fa fa-expand"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
                <div class="no-move"></div>
            </div>
            <div class="box-content statuses">
                <span class='orderstatus orderstatus010'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status1")</span>@ResourceKey("General.orderstatus010") </span>
                <span class='orderstatus orderstatus020'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status2")</span>@ResourceKey("General.orderstatus020") </span>
                <span class='orderstatus orderstatus030'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status3")</span>@ResourceKey("General.orderstatus030") </span>
                <span class='orderstatus orderstatus040'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status4")</span>@ResourceKey("General.orderstatus040") </span>
                <span class='orderstatus orderstatus050'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status5")</span>@ResourceKey("General.orderstatus050") </span>
                <span class='orderstatus orderstatus060'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status6")</span>@ResourceKey("General.orderstatus060") </span>
                <span class='orderstatus orderstatus070'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status7")</span>@ResourceKey("General.orderstatus070") </span>
                <span class='orderstatus orderstatus080'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status8")</span>@ResourceKey("General.orderstatus080") </span>
                <span class='orderstatus orderstatus120'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status12")</span>@ResourceKey("General.orderstatus120") </span>
                <span class='orderstatus orderstatus090'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status9")</span>@ResourceKey("General.orderstatus090") </span>
                <span class='orderstatus orderstatus100'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status10")</span>@ResourceKey("General.orderstatus100") </span>
                <span class='orderstatus orderstatus110'><span class='statusvalue'>@info.GetXmlPropertyInt("root/row/status11")</span>@ResourceKey("General.orderstatus110") </span>
            </div>
        </div>
    </div>


</div>


